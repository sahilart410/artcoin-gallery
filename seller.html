<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ArtCoin â€” Seller Portal (on-chain)</title>
<style>:root{--brand:#6D53F1}body{font-family:Inter,system-ui,Arial,sans-serif;background:#0e102d;color:#fff;margin:0}
.wrap{max-width:960px;margin:0 auto;padding:24px}.card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:16px;margin-top:16px}
label{display:block;margin:8px 0 6px;color:#cfd3ff;font-size:13px}input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff}
.btn{background:var(--brand);border:none;color:#fff;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer}.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}</style>
</head><body>
<div class="wrap">
  <h1>Seller Portal</h1>
  <div class="card">
    <div class="row"><button class="btn" id="btnConnect">Connect Phantom</button><span id="who"></span></div>
    <label>Buyer public key</label><input id="buyer" placeholder="Buyer pubkey (Base58)">
    <label>Tracking (plain)</label><input id="tracking" placeholder="e.g. UPS 1Z...">
    <div class="row" style="margin-top:10px"><button class="btn" id="btnShip">1) Set tracking + Ship</button><button class="btn" id="btnRelease">2) Release (if allowed)</button></div>
    <pre id="out"></pre>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
<script>
const out = (m)=>{ document.getElementById('out').textContent = (m && typeof m==='object')? JSON.stringify(m,null,2): String(m); };
let sellerPk='';
async function connect(){ const p = window.solana; if(!p || !p.isPhantom){ alert('Install Phantom'); return; } const r = await p.connect(); sellerPk = r.publicKey.toString(); document.getElementById('who').textContent = sellerPk; }
function sha256hex(s){ const enc = new TextEncoder(); const data = enc.encode(s); return crypto.subtle.digest('SHA-256', data).then(buf => Array.from(new Uint8Array(buf)).map(x=>x.toString(16).padStart(2,'0')).join('')); }
async function signSend(b64){ const tx = window.solanaWeb3.Transaction.from(Buffer.from(b64, 'base64')); const { signature } = await window.solana.signAndSendTransaction(tx); return signature; }
async function ship(){ const buyer = document.getElementById('buyer').value.trim(); const trk = document.getElementById('tracking').value.trim(); if(!trk) return out('Tracking required');
  const h = await sha256hex(trk); const r = await fetch('/api/onchain/shipTx',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({sellerPubkey:sellerPk,buyerPubkey:buyer,trackingHashHex:h})}).then(r=>r.json());
  if(!r.ok) return out(r); const sig = await signSend(r.tx); out({ step:'ship', sig, escrow:r.escrow }); }
async function release(){ const buyer = document.getElementById('buyer').value.trim();
  const r = await fetch('/api/onchain/releaseTx',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({sellerPubkey:sellerPk,buyerPubkey:buyer})}).then(r=>r.json());
  if(!r.ok) return out(r); const sig = await signSend(r.tx); out({ step:'release', sig, escrow:r.escrow }); }
document.getElementById('btnConnect').onclick=connect; document.getElementById('btnShip').onclick=ship; document.getElementById('btnRelease').onclick=release;
</script>
</body></html>
